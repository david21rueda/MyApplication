CREATE TABLE PELICULA (ID_PELICULA INT PRIMARY KEY ,
					   TITULO VARCHAR(30),
					   DURACION INT,
					   SITIO_WEB VARCHAR(30));
CREATE TABLE PRODUCTORA(RUT INT PRIMARY KEY,
					   NOMBRE VARCHAR(30),
					   DENOMICACION VARCHAR(30));
CREATE TABLE TELEFONOS(RUT_PRO_FK INT PRIMARY KEY,
					   NUM_TEL NUMERIC);
CREATE TABLE ARTISTA  (TIPO_DOC VARCHAR(30),
					   NUMERO_DOC INT,
					   SEXO VARCHAR(30),
					   NOMBRE VARCHAR(30),
					   PRIMARY KEY(TIPO_DOC,NUMERO_DOC));
CREATE TABLE PAIS     (NOMBRE VARCHAR(50) PRIMARY KEY);
CREATE TABLE LOCACION (NOMBRE_FK VARCHAR(50),
					   LOCACION VARCHAR(100) UNIQUE,
					   PRIMARY KEY(NOMBRE_FK,LOCACION));
CREATE TABLE GENERO   (NOMBRE VARCHAR(30) PRIMARY KEY,
					   TIPO VARCHAR(30));
CREATE TABLE VERSIONp (ID_VERSION INT PRIMARY KEY,
					   IDO_DOBLA VARCHAR(30));
CREATE TABLE PRODUCE  (ID_PELI_FK INT,
					   RUT_FK INT,
					   PRIMARY KEY (ID_PELI_FK,RUT_FK));
CREATE TABLE TRABAJAN (ID_PELI_FK INT,
					   TIPO_DOC_FK VARCHAR(30),
					   NUMERO_DOC_FK INT,
					   PRIMARY KEY(ID_PELI_FK,TIPO_DOC_FK,NUMERO_DOC_FK),
					   MIN_PANTALLA INT);
CREATE TABLE ORIGEN   (TIPO_DOC_FK VARCHAR(30),
					   NUMERO_DOC_FK INT,
					   PRIMARY KEY (TIPO_DOC_FK,NUMERO_DOC_FK),
					   NOM_PAIS_FK VARCHAR(50));
CREATE TABLE GEN_PELI (ID_PELI_FK INT PRIMARY KEY,
					   NOM_GEN_FK VARCHAR(30));
CREATE TABLE VERS_PELI(ID_VERS_PELI INT PRIMARY KEY,
					   ID_PELI_FK INT,
					   ID_VERSION_FK INT);
CREATE TABLE LUGAR    (ID_PELI_FK INT PRIMARY KEY,
					   NOM_PAIS_FK VARCHAR(50),
					   LOCACION_FK VARCHAR(100));
CREATE TABLE PRESENTA (NOM_PAIS_FK VARCHAR(50),
					   ID_VERS_PELI_FK INT,
					   PRIMARY KEY (NOM_PAIS_FK,ID_VERS_PELI_FK));
CREATE TABLE CONTRATO (ID_CONTRATO INT PRIMARY KEY,
					   NOM_GEN_FK VARCHAR(30),
					   RUT_FK INT,
					   DESCRIPCION VARCHAR (300),
					   FECHA DATE);
CREATE TABLE DOCS_ARTI(ID_CONTRATO_FK INT PRIMARY KEY,
					   TIPO_DOC_FK VARCHAR(30),
					   NUM_DOC_FK INT,
					   TIPO_ARTISTA VARCHAR (30));
CREATE TABLE FILMA    (ID_CONTRATO_FK INT,
					   ID_PELI_FK INT,
					   PRIMARY KEY(ID_CONTRATO_FK,ID_PELI_FK));



ALTER TABLE PRODUCE ADD CONSTRAINT ID_PELI_FK_PRODUCE FOREIGN KEY (ID_PELI_FK) REFERENCES PELICULA(ID_PELICULA) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE PRODUCE ADD CONSTRAINT RUT_FK_PRODUCE FOREIGN KEY (RUT_FK) REFERENCES PRODUCTORA(RUT) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE TRABAJAN ADD CONSTRAINT ID_PELI_FK_TRABAJAN FOREIGN KEY (ID_PELI_FK) REFERENCES PELICULA(ID_PELICULA) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE TRABAJAN ADD CONSTRAINT DOCUMENTO_TRABAJAN FOREIGN KEY (TIPO_DOC_FK,NUMERO_DOC_FK) REFERENCES ARTISTA(TIPO_DOC,NUMERO_DOC) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE LOCACION ADD CONSTRAINT NOMBRE_FK FOREIGN KEY (NOMBRE_FK) REFERENCES PAIS(NOMBRE) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE ORIGEN ADD CONSTRAINT DOCUMENTO_ORIGEN FOREIGN KEY (TIPO_DOC_FK,NUMERO_DOC_FK) REFERENCES ARTISTA(TIPO_DOC,NUMERO_DOC) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE ORIGEN ADD CONSTRAINT NOM_PAIS_FK_ORIGEN FOREIGN KEY (NOM_PAIS_FK) REFERENCES PAIS(NOMBRE) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE GEN_PELI ADD CONSTRAINT ID_PELI_FK_GEN_PELI FOREIGN KEY (ID_PELI_FK) REFERENCES PELICULA(ID_PELICULA) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE GEN_PELI ADD CONSTRAINT NOM_GEN_FK_GEN_PELI FOREIGN KEY (NOM_GEN_FK) REFERENCES GENERO(NOMBRE) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE VERS_PELI ADD CONSTRAINT ID_PELI_FK_VERS_PELI FOREIGN KEY (ID_PELI_FK) REFERENCES PELICULA(ID_PELICULA) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE VERS_PELI ADD CONSTRAINT ID_VERS_FK FOREIGN KEY (ID_VERSION_FK) REFERENCES VERSIONp(ID_VERSION) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE LUGAR ADD CONSTRAINT ID_PELI_FK_LUGAR FOREIGN KEY (ID_PELI_FK) REFERENCES PELICULA(ID_PELICULA) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE LUGAR ADD CONSTRAINT NOM_PAIS_FK_LUGAR FOREIGN KEY (NOM_PAIS_FK) REFERENCES PAIS(NOMBRE) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE LUGAR ADD CONSTRAINT LOCACION_FK FOREIGN KEY (LOCACION_FK) REFERENCES LOCACION(LOCACION) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE PRESENTA ADD CONSTRAINT NOM_PAIS_FK_PRESENTA FOREIGN KEY (NOM_PAIS_FK) REFERENCES PAIS(NOMBRE) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE PRESENTA ADD CONSTRAINT ID_VERS_PELI_FK FOREIGN KEY (ID_VERS_PELI_FK) REFERENCES VERS_PELI(ID_VERS_PELI) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE TELEFONOS ADD CONSTRAINT RUT_PRO_FK FOREIGN KEY (RUT_PRO_FK) REFERENCES PRODUCTORA(RUT) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE DOCS_ARTI ADD CONSTRAINT ID_CONTRATO_FK_DOCS_ARTI FOREIGN KEY (ID_CONTRATO_FK) REFERENCES CONTRATO(ID_CONTRATO) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE DOCS_ARTI ADD CONSTRAINT ARTISTA FOREIGN KEY (TIPO_DOC_FK,NUM_DOC_FK) REFERENCES ARTISTA(TIPO_DOC,NUMERO_DOC) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE CONTRATO ADD CONSTRAINT NOM_GEN_FK_CONTRATO FOREIGN KEY (NOM_GEN_FK) REFERENCES GENERO(NOMBRE) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE CONTRATO ADD CONSTRAINT RUT_FK_CONTRATO FOREIGN KEY (RUT_FK) REFERENCES PRODUCTORA(RUT) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE FILMA ADD CONSTRAINT ID_CONTRATO_FK_FILMA FOREIGN KEY (ID_CONTRATO_FK) REFERENCES CONTRATO(ID_CONTRATO) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE FILMA ADD CONSTRAINT ID_PELI_FK_FILMA FOREIGN KEY (ID_PELI_FK) REFERENCES PELICULA(ID_PELICULA) ON UPDATE CASCADE ON DELETE CASCADE;

INSERT INTO PELICULA (ID_PELICULA,TITULO,DURACION,SITIO_WEB)
VALUES
(2090,'BATMAN:LA NOCHE OSCURA',10500,'BATMAN@CINEPOLIS.COM'),
(2091,'TENET',12040,'TENET@CINEPOLIS.COM'),
(2092,'PARASITOS',15000,'PARASITOS@CINEPOLIS.COM'),
(2093,'UNIDOS',11023,'UNIDOS@CINEPOLIS.COM'),
(2094,'AVENGERS:ENDGAME',18020,'AVENGERS@CINEPOLIS.COM'),
(2095,'SONIC LA PELICULA',6040,'SONIC@CINEPOLIS.COM'),
(2096,'WONDER WOMAN 2',12017,'WW@CINEPOLIS.COM'),
(2097,'GUASON',12030,'GUASON@CINEPOLIS.COM'),
(2098,'MULAN',12030,'MULAN@CINEPOLIS.COM');
INSERT INTO PRODUCTORA (RUT,NOMBRE,DENOMICACION)
VALUES
(4001,'UNIVERSAL','MIXTO'),
(4002,'WALT DISNEY','INFANTIL'),
(4003,'METRO GOLDWYN MAYER','ANTIGUA'),
(4004,'20TH CENTURY FOX','ACCION'),
(4005,'DREAM WORKS','ROMANCE'),
(4006,'PARAMOUNT','JUVENIL'),
(4007,'SONY','MIXTA'),
(4008,'FOX','MIXTA');
INSERT INTO TELEFONOS(RUT_PRO_FK,NUM_TEL)
VALUES
(4001,3016415017),
(4002,3222611239),
(4003,3102359898),
(4004,3110923493),
(4005,3204859385),
(4006,3149583920),
(4007,3178394839),
(4008,3009483984);
INSERT INTO ARTISTA (TIPO_DOC,NUMERO_DOC,SEXO,NOMBRE)
VALUES
('CC',109021,'FEMENINO','MERYL STREEP'),
('CC',109022,'MASCULINO','JOHN TRAVOLTA'),
('CC',109023,'MASCULINO','RAUL RUIZ'),
('CC',109024,'MASCULINO','ADAM SANDLER'),
('CC',109025,'MASCULINO','ED HARRIS'),
('CC',109026,'FEMENINO','HALLE BERRY'),
('CC',109027,'FEMENINO','PENELOPE CRUZ'),
('CC',109028,'MASCULINO','JOHNNY DEPP');
INSERT INTO PAIS (NOMBRE)
VALUES
('ESTADOS UNIDOS'),
('ALEMANIA'),
('BELGICA'),
('FRANCIA'),
('ESPAÑA'),
('DINAMARCA'),
('ESTONIA'),
('GRECIA'),
('FINLANDIA');
INSERT INTO LOCACION(NOMBRE_FK,LOCACION)
VALUES
('ESTADOS UNIDOS','A'),
('ALEMANIA','B'),
('BELGICA','C'),
('FRANCIA','F'),
('ESPAÑA','S'),
('DINAMARCA','E'),
('ESTONIA','G'),
('GRECIA','K'),
('FINLANDIA','R');
INSERT INTO GENERO(NOMBRE,TIPO)
VALUES
('ACCION','AC'),
('AVENTURAS','AV'),
('COMEDIAS','CO'),
('DRAMATICAS','DR'),
('TERROR','TE'),
('MUSICALES','MU'),
('FICCION','FI'),
('BELICAS','BE');
INSERT INTO VERSIONp (ID_VERSION,IDO_DOBLA)
VALUES
(301,'INGLES'),
(302,'ALEMAN'),
(303,'ESPAÑOL'),
(304,'INGLES'),
(305,'ESPAÑOL'),
(306,'INGLES'),
(307,'ESPAÑOL'),
(308,'INGLES');
INSERT INTO PRODUCE(ID_PELI_FK,RUT_FK)
VALUES
(2090,4008),
(2095,4006),
(2094,4008),
(2091,4001),
(2092,4003),
(2096,4002),
(2093,4004),
(2097,4007),
(2090,4002),
(2098,4005),
(2093,4005),
(2091,4007),
(2094,4001),
(2090,4005),
(2095,4005),
(2096,4006),
(2098,4008),
(2091,4005),
(2094,4004);
INSERT INTO TRABAJAN(ID_PELI_FK,TIPO_DOC_FK,NUMERO_DOC_FK,MIN_PANTALLA)
VALUES
(2096,'CC',109027,181),
(2095,'CC',109024,181),
(2097,'CC',109027,181),
(2098,'CC',109022,161),
(2094,'CC',109022,115),
(2093,'CC',109025,114),
(2091,'CC',109024,313),
(2094,'CC',109023,112),
(2090,'CC',109028,111),
(2092,'CC',109027,210),
(2091,'CC',109028,109),
(2097,'CC',109022,178),
(2092,'CC',109026,407),
(2094,'CC',109026,146),
(2093,'CC',109027,345),
(2094,'CC',109025,94),
(2093,'CC',109021,612),
(2092,'CC',109028,171),
(2092,'CC',109021,179),
(2096,'CC',109026,109),
(2091,'CC',109026,119);
INSERT INTO ORIGEN(TIPO_DOC_FK,NUMERO_DOC_FK,NOM_PAIS_FK)
VALUES
('CC',109021,'FINLANDIA'),
('CC',109027,'GRECIA'),
('CC',109022,'ESTONIA'),
('CC',109023,'DINAMARCA'),
('CC',109025,'ESPAÑA'),
('CC',109026,'FRANCIA'),
('CC',109028,'BELGICA'),
('CC',109024,'ALEMANIA');
INSERT INTO GEN_PELI(ID_PELI_FK,NOM_GEN_FK)
VALUES
(2090,'ACCION'),
(2091,'FICCION'),
(2092,'BELICAS'),
(2093,'DRAMATICAS'),
(2094,'FICCION'),
(2095,'MUSICALES'),
(2096,'FICCION'),
(2097,'ACCION'),
(2098,'COMEDIAS');
INSERT INTO VERS_PELI(ID_VERS_PELI,ID_PELI_FK,ID_VERSION_FK)
VALUES
(901,2090,301),
(902,2091,302),
(903,2092,303),
(904,2093,304),
(905,2094,305),
(906,2095,306),
(907,2096,307),
(908,2097,308);
INSERT INTO LUGAR(ID_PELI_FK,NOM_PAIS_FK,LOCACION_FK)
VALUES
(2090,'ESTADOS UNIDOS','A'),
(2091,'ALEMANIA','B'),
(2092,'BELGICA','C'),
(2093,'FRANCIA','F'),
(2094,'ESPAÑA','S'),
(2095,'DINAMARCA','E'),
(2096,'ESTONIA','G'),
(2097,'GRECIA','K'),
(2098,'FINLANDIA','R');
INSERT INTO PRESENTA(NOM_PAIS_FK,ID_VERS_PELI_FK)
VALUES
('ESTADOS UNIDOS',901),
('ALEMANIA',902),
('BELGICA',903),
('FRANCIA',904),
('ESPAÑA',905),
('DINAMARCA',906),
('ESTONIA',907),
('GRECIA',908),
('FINLANDIA',901),
('ESTADOS UNIDOS',902),
('ALEMANIA',903),
('BELGICA',904),
('FRANCIA',905),
('ESPAÑA',908),
('DINAMARCA',903),
('ESTONIA',902),
('GRECIA',901);
INSERT INTO CONTRATO(ID_CONTRATO,NOM_GEN_FK,RUT_FK,DESCRIPCION,FECHA)
VALUES
(51,'ACCION',4001,'TERMINO TEMPORAL','2019-10-16'),
(52,'AVENTURAS',4003,'TERMINO INDEFINIDO','2018-10-20'),
(53,'COMEDIAS',4002,'TERMINO TEMPORAL','2018-09-26'),
(54,'DRAMATICAS',4004,'TERMINO INDEFINIDO','2017-03-12'),
(55,'TERROR',4005,'TERMINO INDEFINIDO','2015-02-12'),
(56,'MUSICALES',4006,'TERMINO INDEFINIDO','2020-03-22'),
(57,'DRAMATICAS',4007,'TERMINO INDEFINIDO','2017-03-12'),
(58,'FICCION',4008,'TERMINO INDEFINIDO','2018-09-30'),
(59,'BELICAS',4004,'TERMINO TEMPORAL','2019-11-11'),
(60,'TERROR',4007,'TERMINO INDEFINIDO','2018-03-12'),
(61,'COMEDIAS',4006,'TERMINO TEMPORAL','2017-07-02'),
(62,'AVENTURAS',4005,'TERMINO INDEFINIDO','2019-07-29'),
(63,'ACCION',4004,'TERMINO INDEFINIDO','2017-09-12'),
(64,'BELICAS',4003,'TERMINO TEMPORAL','2018-02-23'),
(65,'FICCION',4002,'TERMINO TEMPORAL','2020-04-12'),
(66,'MUSICALES',4001,'TERMINO INDEFINIDO','2019-08-20'),
(67,'AVENTURAS',4004,'TERMINO INDEFINIDO','2018-04-12'),
(68,'TERROR',4007,'TERMINO TEMPORAL','2019-03-31'),
(69,'COMEDIAS',4008,'TERMINO INDEFINIDO','2018-06-18');
INSERT INTO DOCS_ARTI(ID_CONTRATO_FK,TIPO_DOC_FK,NUM_DOC_FK,TIPO_ARTISTA)
VALUES
(51,'CC','109021','ACTOR'),
(52,'CC','109022','ARTISTA'),
(53,'CC','109023','ACTOR'),
(54,'CC','109024','ACTOR'),
(55,'CC','109025','ARTISTA'),
(56,'CC','109026','ARTISTA'),
(57,'CC','109027','ACTOR'),
(58,'CC','109028','ARTISTA'),
(59,'CC','109021','ACTOR'),
(60,'CC','109022','ARTISTA'),
(61,'CC','109023','ACTOR'),
(62,'CC','109024','ACTOR'),
(63,'CC','109025','ARTISTA'),
(64,'CC','109026','ACTOR'),
(65,'CC','109027','ARTISTA'),
(66,'CC','109021','ACTOR'),
(67,'CC','109022','ARTISTA'),
(68,'CC','109023','ACTOR'),
(69,'CC','109024','ARTISTA');
INSERT INTO FILMA(ID_CONTRATO_FK,ID_PELI_FK)
VALUES
(51,2090),
(52,2091),
(53,2092),
(54,2093),
(55,2094),
(56,2095),
(57,2096),
(58,2097),
(59,2098),
(60,2090),
(61,2091),
(62,2092),
(63,2093),
(64,2094),
(65,2095);


--Se desea conocer el nombre de todas las películas en las que ha participado un actor
SELECT PELICULA.TITULO 
FROM PELICULA, ARTISTA, TRABAJAN
WHERE ARTISTA.TIPO_DOC=TRABAJAN.TIPO_DOC_FK AND
	  ARTISTA.NUMERO_DOC=TRABAJAN.NUMERO_DOC_FK AND
	  TRABAJAN.ID_PELI_FK=PELICULA.ID_PELICULA AND
	  ARTISTA.NOMBRE='HALLE BERRY';

--Se desea conocer cuál es el género en el que más ha participado el actor
SELECT GEN_PELI.NOM_GEN_FK,
COUNT(GEN_PELI.NOM_GEN_FK) AS NUM
FROM PELICULA, ARTISTA, TRABAJAN, GEN_PELI
WHERE ARTISTA.TIPO_DOC=TRABAJAN.TIPO_DOC_FK AND
	  ARTISTA.NUMERO_DOC=TRABAJAN.NUMERO_DOC_FK AND
	  TRABAJAN.ID_PELI_FK=PELICULA.ID_PELICULA AND
	  PELICULA.ID_PELICULA=GEN_PELI.ID_PELI_FK AND
	  ARTISTA.NOMBRE='HALLE BERRY'
GROUP BY GEN_PELI.NOM_GEN_FK
ORDER BY GEN_PELI.NOM_GEN_FK DESC
LIMIT 1;


--Dada una película Y, se desea conocer cuáles son sus versiones
SELECT VERS_PELI.ID_VERS_PELI
FROM  PELICULA,VERS_PELI
WHERE PELICULA.ID_PELICULA=VERS_PELI.ID_PELI_FK AND
	  PELICULA.TITULO='AVENGERS:ENDGAME';
	  
--Se desea conocer cuántas películas se han filmado en cada país
SELECT PAIS.NOMBRE,
COUNT(LUGAR.NOM_PAIS_FK ) AS NUM
FROM PELICULA, LUGAR, PAIS
WHERE PELICULA.ID_PELICULA=LUGAR.ID_PELI_FK AND
	  LUGAR.NOM_PAIS_FK =PAIS.NOMBRE
GROUP BY PAIS.NOMBRE
ORDER BY PAIS.NOMBRE DESC;

--Se desea conocer el nombre de la película, el nombre del género, el país en el que fue
--filmada, y la productora que realizó la filmación, de la película con mayor duración.

SELECT PELICULA.TITULO, GENERO.NOMBRE, PAIS.NOMBRE, PRODUCTORA.NOMBRE, PELICULA.DURACION
FROM PELICULA, PAIS, GENERO, GEN_PELI, LUGAR, PRODUCTORA, PRODUCE
WHERE PELICULA.ID_PELICULA=PRODUCE.ID_PELI_FK AND
	  PRODUCE.RUT_FK=PRODUCTORA.RUT AND
	  PELICULA.ID_PELICULA=GEN_PELI.ID_PELI_FK AND
	  GEN_PELI.NOM_GEN_FK=GENERO.NOMBRE AND
	  PELICULA.ID_PELICULA=LUGAR.ID_PELI_FK AND
	  LUGAR.NOM_PAIS_FK =PAIS.NOMBRE
ORDER BY PELICULA.DURACION DESC
LIMIT 1;
	  

